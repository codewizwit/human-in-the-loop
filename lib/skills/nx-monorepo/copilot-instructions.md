---
applyTo: 'nx.json,project.json,**/project.json,*.nx.ts'
---

# Nx Monorepo Development

This project uses **Nx** for monorepo management. Follow these guidelines:

## Core Principles

1. **Apps vs Libs** - Apps are deployable, libs are shared code
2. **Project Boundaries** - Enforce dependencies with tags and constraints
3. **Affected Commands** - Only build/test what changed
4. **Computation Caching** - Cache task outputs for speed

## Workspace Structure

```
// ✅ CORRECT: Organized by scope and type
libs/
├── shared/           # Cross-app shared
│   ├── ui/           # UI components
│   ├── util/         # Utilities
│   └── data-access/  # API clients
├── feature-auth/     # Feature library
└── app-specific/     # App-specific libs

// ❌ WRONG: Flat structure
libs/
├── button/
├── api-client/
├── auth-guard/
└── utils/
```

## Project Tags

```json
// ✅ CORRECT: Use tags for boundaries
// project.json
{
  "tags": ["type:feature", "scope:shared"]
}

// ❌ WRONG: No tags
{
  "tags": []
}
```

## Dependency Constraints

```json
// ✅ CORRECT: Enforce boundaries
{
  "@nx/enforce-module-boundaries": [
    "error",
    {
      "depConstraints": [
        {
          "sourceTag": "type:app",
          "onlyDependOnLibsWithTags": ["type:feature", "type:ui"]
        },
        {
          "sourceTag": "type:feature",
          "onlyDependOnLibsWithTags": ["type:ui", "type:util"]
        },
        { "sourceTag": "type:ui", "onlyDependOnLibsWithTags": ["type:util"] }
      ]
    }
  ]
}
```

## Caching

```json
// ✅ CORRECT: Define cacheable operations
// nx.json
{
  "targetDefaults": {
    "build": {
      "cache": true,
      "dependsOn": ["^build"]
    },
    "test": {
      "cache": true
    },
    "lint": {
      "cache": true
    }
  }
}
```

## Commands

```bash
# ✅ CORRECT: Use affected for CI
nx affected -t test --parallel=5
nx affected -t build

# ✅ CORRECT: Run specific target
nx run my-app:build:production

# ❌ WRONG: Run all in CI
nx run-many -t test --all  # Slow, ignores cache benefits
```

## Library Types

| Type               | Purpose                          | Can Depend On                  |
| ------------------ | -------------------------------- | ------------------------------ |
| `type:app`         | Deployable application           | feature, ui, util, data-access |
| `type:feature`     | Business logic, smart components | ui, util, data-access          |
| `type:ui`          | Presentational components        | util                           |
| `type:data-access` | API clients, state management    | util                           |
| `type:util`        | Pure utilities, helpers          | Nothing                        |

## Anti-Patterns to Avoid

❌ **NO** circular dependencies between libs
❌ **NO** apps depending on other apps
❌ **NO** deep imports (`@myorg/lib/src/internal`)
❌ **NO** skipping affected in CI (`--all` instead of `affected`)
❌ **NO** libs without tags

## Best Practices

✅ **DO** use barrel exports (index.ts)
✅ **DO** tag all projects with type and scope
✅ **DO** use `nx affected` in CI pipelines
✅ **DO** enable remote caching for teams
✅ **DO** visualize dependencies with `nx graph`
✅ **DO** create generators for consistent lib creation

---

**Generated by Human-in-the-Loop AI Hub**
Framework expertise for Nx monorepo development
